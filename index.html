<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f0f10" />
  <title>Film Roll Index</title>
  <style>
    :root {
      --bg: #0f0f10;
      --card: #17181a;
      --text: #e8e8ea;
      --muted: #a8a8ad;
      --accent: #7aa2ff;
      --accent-2: #74d4c6;
      --ring: #2a2b31;
      --shadow: rgba(0,0,0,0.5);
      --radius: 14px;
      --bg-grad: radial-gradient(1200px 800px at 20% -10%, #15161a 0%, #0f0f10 50%, #0b0b0c 100%);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
    }
    :root[data-theme="light"] {
      --bg: #ffffff;
      --card: #f7f7f8;
      --text: #0f0f10;
      --muted: #5f6067;
      --accent: #2554ff;
      --accent-2: #0ba895;
      --ring: #e5e7eb;
      --shadow: rgba(0,0,0,0.12);
      --bg-grad: radial-gradient(1400px 900px at 20% -10%, #f4f6fb 0%, #ffffff 60%, #fbfbfd 100%);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
    }
    :root[data-theme="news"] {
      --bg: #faf3e0;
      --card: #fffdf7;
      --text: #1e1b16;
      --muted: #6a6257;
      --accent: #8b5e34;
      --accent-2: #3f6b59;
      --ring: #e9ddc9;
      --shadow: rgba(30,27,22,0.1);
      --bg-grad: radial-gradient(1200px 800px at 20% -10%, #fff7e6 0%, #faf3e0 60%, #f6edd9 100%);
      --font: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: var(--font);
      background: var(--bg-grad);
      color: var(--text);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: saturate(140%) blur(8px);
      background: linear-gradient(180deg, rgba(15,15,16,0.85), rgba(15,15,16,0.6));
      border-bottom: 1px solid var(--ring);
    }
    .topbar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: max(env(safe-area-inset-top), 12px) 16px 12px 16px;
    }
    .brand {
      font-weight: 700;
      letter-spacing: 0.2px;
      font-size: 18px;
    }
    .meta { color: var(--muted); font-size: 13px; }

    .controls {
      display: flex; gap: 8px; margin-left: auto; align-items: center;
    }
    .btn {
      appearance: none; border: 1px solid var(--ring); background: var(--card); color: var(--text);
      border-radius: 999px; padding: 8px 12px; font-size: 13px; cursor: pointer;
      display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 6px 20px var(--shadow);
    }
    .btn:hover { border-color: #2f6feb; color: #cfe0ff; }
    .select { appearance: none; border: 1px solid var(--ring); background: var(--card); color: var(--text); border-radius: 999px; padding: 8px 12px; font-size: 13px; box-shadow: 0 6px 20px var(--shadow); }

    main { padding: 18px 0 36px; }

    .filmroll {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 82vw;
      gap: 14px;
      padding: 10px 16px 18px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    @media (min-width: 720px) {
      .filmroll { grid-auto-columns: min(480px, 42vw); }
    }
    /* Grid mode */
    .filmroll.grid { grid-auto-flow: row; grid-auto-columns: unset; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); overflow-x: visible; scroll-snap-type: none; }
    @media (min-width: 720px) { .filmroll.grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); } }

    .shot {
      scroll-snap-align: start;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));
      border: 1px solid var(--ring);
      border-radius: var(--radius);
      overflow: clip;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      min-height: 260px;
      position: relative;
    }

    .frame {
      aspect-ratio: 16 / 9;
      width: 100%;
      /* Black background to ensure consistent preview backing */
      background: #000;
      border-bottom: 1px solid var(--ring);
      position: relative;
    }
    .frame iframe {
      width: 100%; height: 100%; border: 0; display: block; border-bottom: 1px solid var(--ring);
    }
    .frame .overlay {
      position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
      background: linear-gradient(180deg, rgba(11,12,15,0.0), rgba(11,12,15,0.45));
      opacity: 0; transition: opacity 200ms ease;
    }
    .frame:hover .overlay { opacity: 1; }
    .overlay .play {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 999px;
      border: 1px solid var(--ring); background: rgba(23,24,26,0.85); color: var(--text);
    }

    .info { padding: 10px 12px 12px; display: grid; gap: 8px; }
    .title { font-weight: 600; font-size: 14px; line-height: 1.35; }
    .title small { color: var(--muted); font-weight: 400; }
    .actions { display: flex; gap: 8px; }
    .badges { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }
    .badge { display: inline-flex; align-items: center; gap: 6px; font-size: 11px; padding: 4px 8px; border-radius: 999px; border: 1px dashed var(--ring); color: var(--muted); background: transparent; }
    .pill {
      border: 1px solid var(--ring); background: var(--card); color: var(--text); border-radius: 10px;
      padding: 8px 10px; font-size: 12px; display: inline-flex; align-items: center; gap: 6px; cursor: pointer; text-decoration: none;
    }
    .pill:hover { border-color: #2f6feb; color: #cfe0ff; }

    .film-edge {
      position: absolute; top: 0; bottom: 0; width: 10px; left: -6px; right: auto;
      background: repeating-linear-gradient(180deg, #26272b, #26272b 10px, #1a1b1f 10px, #1a1b1f 20px);
      filter: drop-shadow(2px 0 0 rgba(0,0,0,0.25)); border-radius: 8px;
    }

    /* States */
    .shot.selected { outline: 2px solid var(--accent); outline-offset: -2px; }
    .shot.is-fixed { border-color: var(--accent-2); box-shadow: 0 12px 36px rgba(0,0,0,0.45); }
    .shot.is-fixed::after {
      content: 'Fixed'; position: absolute; top: 8px; right: -28px; transform: rotate(35deg);
      background: var(--accent-2); color: #0b0c0f; font-weight: 700; font-size: 10px;
      padding: 4px 28px; border-radius: 2px; letter-spacing: .5px;
    }

    /* Modal */
    .modal {
      position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,0,0,0.6);
      z-index: 50; padding: 24px;
    }
    .modal.open { display: grid; }
    .modal-card {
      width: min(100%, 1200px); height: min(88vh, 720px); border-radius: 16px; overflow: hidden;
      background: #0b0c0f; border: 1px solid var(--ring); box-shadow: 0 30px 80px rgba(0,0,0,0.5);
      display: grid; grid-template-rows: auto 1fr;
    }
    .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-bottom: 1px solid var(--ring); }
    .modal-title { font-weight: 600; font-size: 14px; }
    .close-btn { border: 1px solid var(--ring); background: var(--card); color: var(--text); border-radius: 999px; padding: 6px 10px; cursor: pointer; }
    .modal-body { position: relative; }
    .modal-body iframe { position: absolute; inset: 0; width: 100%; height: 100%; border: 0; }

    /* Helpers */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; white-space: nowrap; }

    /* Pull-to-edges padding on notched devices */
    .p-safe { padding-left: max(env(safe-area-inset-left), 16px); padding-right: max(env(safe-area-inset-right), 16px); }
  </style>
</head>
<body>
  <header>
    <div class="topbar p-safe">
      <div class="brand">Film Roll Index</div>
      <div class="meta" id="countMeta">0 shots</div>
      <div class="controls">
        <select class="select" id="viewMode" aria-label="View Mode">
          <option value="film">Film Roll</option>
          <option value="grid">Grid</option>
        </select>
        <select class="select" id="themeMode" aria-label="Theme">
          <option value="dark">Black</option>
          <option value="light">White</option>
          <option value="news">Newspaper</option>
        </select>
        <button class="btn" id="toggleDensity">Compact</button>
      </div>
    </div>
  </header>

  <main>
    <section class="filmroll" id="filmroll" aria-live="polite"></section>
  </main>

  <!-- Playlist toolbar -->
  <div class="playlist-bar p-safe" id="playlistBar" style="position: sticky; bottom: 0; inset-inline: 0; display: none; padding: 10px 16px; background: color-mix(in oklab, var(--bg) 88%, transparent); border-top: 1px solid var(--ring); gap: 8px; align-items: center; z-index: 20;">
    <span id="selectionCount" class="meta">0 selected</span>
    <input id="playlistName" class="select" style="border-radius: 10px; min-width: 160px;" placeholder="Playlist name" />
    <button class="btn" id="savePlaylist">Save</button>
    <select class="select" id="loadPlaylist" style="min-width: 160px;">
      <option value="">Load playlist…</option>
    </select>
    <button class="btn" id="playPlaylist">Play ▶</button>
    <button class="btn" id="clearSelection">Clear</button>
    <button class="btn" id="deletePlaylist" title="Delete loaded playlist">Delete</button>
  </div>

  <!-- Modal for enlarged presentation -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Preview</div>
        <button class="close-btn" id="closeModal" aria-label="Close">Close</button>
      </div>
      <div class="modal-body">
        <iframe id="modalFrame" referrerpolicy="no-referrer"></iframe>
      </div>
    </div>
  </div>

  <script>
    // List of HTML documents to index (auto-generated)
    const documents = [
      { path: 'ai_studio_code - 2025-09-18T125634.521.html' },
      { path: 'ai_studio_code - 2025-09-18T130206.784.html' },
      { path: 'ai_studio_code - 2025-09-18T130707.466.html' },
      { path: 'ai_studio_code - 2025-09-18T130833.175.html' },
      { path: 'ai_studio_code - 2025-09-18T131149.302.html' },
      { path: 'ai_studio_code - 2025-09-18T131427.306.html' },
      { path: 'ai_studio_code - 2025-09-18T131542.231.html' },
      { path: 'ai_studio_code - 2025-09-18T131555.655.html' },
      { path: 'ai_studio_code - 2025-09-18T131603.159.html' },
      { path: 'ai_studio_code - 2025-09-18T132452.819.html' },
      { path: 'ai_studio_code - 2025-09-18T132737.678.html' },
      { path: 'comparative_formal_models_single_file_presentation.html' },
      { path: 'flusser_4_platforms_clean_deck.html' },
      { path: 'flusser_episodes_mobile_presentation_player (1).html' },
      { path: 'flusser_episodes_mobile_presentation_player.html' },
      { path: 'post_binary_media_theory_single_file_presentation.html' }
    ].map((d) => {
      const meta = parseVersionFromFilename(d.path);
      return { ...d, title: beautifyTitle(d.path), versionLabel: meta.label, sortKey: meta.sortKey };
    }).sort((a,b) => b.sortKey - a.sortKey);

    function beautifyTitle(filename) {
      const name = filename.replace(/\.html$/i, '')
        .replace(/[_-]+/g, ' ')
        .replace(/\s+/g, ' ')
        .trim();
      return name.charAt(0).toUpperCase() + name.slice(1);
    }
    function parseVersionFromFilename(filename) {
      const m = filename.match(/(\d{4}-\d{2}-\d{2})T(\d{6})(?:\.(\d{3}))?/);
      if (!m) return { label: 'v—', sortKey: 0 };
      const [_, ymd, hms, ms = '000'] = m;
      const hh = hms.slice(0,2), mm = hms.slice(2,4), ss = hms.slice(4,6);
      const sortKey = Number(`${ymd.replace(/-/g,'')}${hh}${mm}${ss}${ms}`);
      const label = `v${ymd} ${hh}:${mm}:${ss}.${ms}`;
      return { label, sortKey };
    }

    const filmroll = document.getElementById('filmroll');
    const countMeta = document.getElementById('countMeta');
    countMeta.textContent = `${documents.length} shots`;

    function shotTemplate(doc, index) {
      const id = `shot-${index}`;
      return `
        <article class="shot" data-path="${doc.path}" data-title="${doc.title}">
          <div class="film-edge" aria-hidden="true"></div>
          <div class="frame" data-iframe-container>
            <iframe title="${doc.title}" data-src="${doc.path}" loading="lazy" referrerpolicy="no-referrer"></iframe>
            <div class="overlay">
              <button class="play pill" data-open>Present ▶</button>
            </div>
          </div>
          <div class="info">
            <div class="title">${doc.title} <small>(${doc.path})</small></div>
            <div class="badges"><span class="badge">${doc.versionLabel}</span></div>
            <div class="actions">
              <label class="pill" style="gap:10px; user-select: none;">
                <input type="checkbox" data-select style="accent-color: var(--accent); width: 16px; height: 16px;" /> Select
              </label>
              <button class="pill" data-fixed>Fixed ✓</button>
              <button class="pill" data-open>Open Modal</button>
              <a class="pill" href="${doc.path}" target="_blank" rel="noopener">Open in New Tab ↗</a>
            </div>
          </div>
        </article>
      `;
    }

    filmroll.innerHTML = documents.map(shotTemplate).join('');

    // Lazy-load iframes when visible using IntersectionObserver
    const io = new IntersectionObserver((entries) => {
      for (const entry of entries) {
        if (entry.isIntersecting) {
          const iframe = entry.target.querySelector('iframe');
          if (iframe && !iframe.src) {
            iframe.src = iframe.dataset.src;
          }
          io.unobserve(entry.target);
        }
      }
    }, { root: filmroll, rootMargin: '200px', threshold: 0.01 });

    document.querySelectorAll('[data-iframe-container]').forEach(el => io.observe(el));

    // Modal logic
    const modal = document.getElementById('modal');
    const modalFrame = document.getElementById('modalFrame');
    const closeModalBtn = document.getElementById('closeModal');
    // next/prev controls for playlist
    const modalHeader = document.querySelector('.modal-header');
    const nextBtn = document.createElement('button'); nextBtn.className = 'btn'; nextBtn.textContent = 'Next ▶';
    const prevBtn = document.createElement('button'); prevBtn.className = 'btn'; prevBtn.textContent = '◀ Prev';
    const headerRight = document.createElement('div'); headerRight.style.display = 'flex'; headerRight.style.gap = '8px';
    headerRight.appendChild(prevBtn); headerRight.appendChild(nextBtn);
    modalHeader.appendChild(headerRight);

    function openModal(path, title) {
      modal.classList.add('open');
      modalFrame.src = path;
      document.getElementById('modalTitle').textContent = title || 'Preview';
      history.replaceState(null, '', updateQueryString('open', encodeURIComponent(path)));
    }
    function closeModal() {
      modal.classList.remove('open');
      modalFrame.src = '';
      history.replaceState(null, '', updateQueryString('open', null));
    }

    document.addEventListener('click', (e) => {
      const openBtn = e.target.closest('[data-open]');
      if (openBtn) {
        const shot = openBtn.closest('.shot');
        if (shot) openModal(shot.dataset.path, shot.dataset.title);
      }
      const fixedBtn = e.target.closest('[data-fixed]');
      if (fixedBtn) {
        const shot = fixedBtn.closest('.shot');
        if (shot) toggleFixed(shot.dataset.path, shot);
      }
    });
    document.getElementById('closeModal').addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.classList.contains('open')) closeModal(); });

    // Allow tapping the frame to open
    document.querySelectorAll('.frame').forEach(frame => {
      frame.addEventListener('click', () => {
        const shot = frame.closest('.shot');
        if (shot) openModal(shot.dataset.path, shot.dataset.title);
      });
    });

    // View & Theme controls
    const filmrollEl = document.getElementById('filmroll');
    const viewMode = document.getElementById('viewMode');
    const themeMode = document.getElementById('themeMode');
    const metaTheme = document.querySelector('meta[name="theme-color"]');

    function applyView(mode) {
      filmrollEl.classList.toggle('grid', mode === 'grid');
    }
    function applyTheme(theme) {
      const map = { dark: '#0f0f10', light: '#ffffff', news: '#faf3e0' };
      document.documentElement.setAttribute('data-theme', theme === 'dark' ? '' : theme);
      if (theme === 'dark') document.documentElement.removeAttribute('data-theme');
      if (metaTheme) metaTheme.setAttribute('content', map[theme] || '#0f0f10');
    }
    function persist(key, val) { try { localStorage.setItem(key, val); } catch(e){} }
    function retrieve(key, fallback) { try { return localStorage.getItem(key) || fallback; } catch(e){ return fallback; } }
    function getParam(name) { const p = new URLSearchParams(location.search); return p.get(name); }
    function setParam(name, value) { const url = new URL(location.href); if (value==null) url.searchParams.delete(name); else url.searchParams.set(name, value); history.replaceState(null, '', url.toString()); }

    // Initialize controls from URL or localStorage
    const initView = getParam('view') || retrieve('view', 'film');
    const initTheme = getParam('theme') || retrieve('theme', 'dark');
    viewMode.value = initView;
    themeMode.value = initTheme;
    applyView(initView);
    applyTheme(initTheme);
    persist('view', initView);
    persist('theme', initTheme);

    viewMode.addEventListener('change', () => { applyView(viewMode.value); persist('view', viewMode.value); setParam('view', viewMode.value); });
    themeMode.addEventListener('change', () => { applyTheme(themeMode.value); persist('theme', themeMode.value); setParam('theme', themeMode.value); });

    // Density toggle
    const toggleDensity = document.getElementById('toggleDensity');
    let compact = retrieve('density', 'comfort') === 'compact';
    function applyDensity() {
      document.documentElement.style.setProperty('--radius', compact ? '10px' : '14px');
      document.querySelectorAll('.shot .frame').forEach(el => el.style.aspectRatio = compact ? '4 / 3' : '16 / 9');
      toggleDensity.textContent = compact ? 'Comfort' : 'Compact';
    }
    applyDensity();
    toggleDensity.addEventListener('click', () => {
      compact = !compact; persist('density', compact ? 'compact' : 'comfort'); applyDensity();
    });

    // Fixed markers persistence
    function isFixed(path) { try { return localStorage.getItem('fixed:'+path) === '1'; } catch(e){ return false; } }
    function setFixed(path, val) { try { localStorage.setItem('fixed:'+path, val ? '1' : '0'); } catch(e){} }
    function applyFixedUI(shotEl, fixed) {
      shotEl.classList.toggle('is-fixed', fixed);
      const btn = shotEl.querySelector('[data-fixed]');
      if (btn) btn.textContent = fixed ? 'Fixed ✓' : 'Mark Fixed';
    }
    function toggleFixed(path, shotEl) { const v = !isFixed(path); setFixed(path, v); applyFixedUI(shotEl, v); }

    // Selection & playlist
    const playlistBar = document.getElementById('playlistBar');
    const selectionCount = document.getElementById('selectionCount');
    const playlistName = document.getElementById('playlistName');
    const savePlaylistBtn = document.getElementById('savePlaylist');
    const loadPlaylistSel = document.getElementById('loadPlaylist');
    const playPlaylistBtn = document.getElementById('playPlaylist');
    const clearSelectionBtn = document.getElementById('clearSelection');
    const deletePlaylistBtn = document.getElementById('deletePlaylist');

    let selectedOrder = [];
    const selectedSet = new Set();

    function updateBar() {
      selectionCount.textContent = `${selectedOrder.length} selected`;
      playlistBar.style.display = selectedOrder.length > 0 ? 'flex' : 'none';
    }
    function attachSelectionHandlers() {
      document.querySelectorAll('[data-select]').forEach(cb => {
        const shot = cb.closest('.shot');
        const path = shot.dataset.path;
        cb.checked = selectedSet.has(path);
        shot.classList.toggle('selected', cb.checked);
        cb.addEventListener('change', () => {
          if (cb.checked) { if (!selectedSet.has(path)) { selectedSet.add(path); selectedOrder.push(path); } }
          else { selectedSet.delete(path); selectedOrder = selectedOrder.filter(p => p !== path); }
          shot.classList.toggle('selected', cb.checked);
          updateBar();
        });
      });
    }
    function loadPlaylists() {
      const list = JSON.parse(localStorage.getItem('playlists')||'[]');
      loadPlaylistSel.innerHTML = '<option value="">Load playlist…</option>' + list.map((pl, i) => `<option value="${pl.name}">${pl.name} (${pl.items.length})</option>`).join('');
      return list;
    }
    function savePlaylists(list) { localStorage.setItem('playlists', JSON.stringify(list)); }
    function getPlaylistByName(name) { return loadPlaylists().find(p => p.name === name); }

    savePlaylistBtn.addEventListener('click', () => {
      const name = (playlistName.value || '').trim();
      if (!name || selectedOrder.length === 0) return;
      const list = loadPlaylists();
      const idx = list.findIndex(p => p.name === name);
      const payload = { name, items: [...selectedOrder] };
      if (idx >= 0) list[idx] = payload; else list.push(payload);
      savePlaylists(list); loadPlaylists();
    });
    loadPlaylistSel.addEventListener('change', () => {
      const name = loadPlaylistSel.value; if (!name) return;
      const pl = getPlaylistByName(name); if (!pl) return;
      selectedOrder = [...pl.items]; selectedSet.clear(); pl.items.forEach(p => selectedSet.add(p));
      document.querySelectorAll('[data-select]').forEach(el => { const shot = el.closest('.shot'); const path = shot.dataset.path; const on = selectedSet.has(path); el.checked = on; shot.classList.toggle('selected', on); });
      playlistName.value = name; updateBar();
    });
    deletePlaylistBtn.addEventListener('click', () => {
      const name = loadPlaylistSel.value; if (!name) return;
      const list = loadPlaylists().filter(p => p.name !== name); savePlaylists(list); loadPlaylists();
      if (playlistName.value === name) playlistName.value = '';
    });
    clearSelectionBtn.addEventListener('click', () => {
      selectedOrder = []; selectedSet.clear(); document.querySelectorAll('[data-select]').forEach(el => { el.checked = false; el.closest('.shot').classList.remove('selected'); }); updateBar();
    });

    // Playlist play logic
    let playingList = null; let playIndex = 0;
    function playList(items, start = 0) {
      if (!items || items.length === 0) return;
      playingList = items; playIndex = Math.max(0, Math.min(start, items.length - 1));
      openModal(playingList[playIndex], beautifyTitle(playingList[playIndex]));
      updatePrevNext();
    }
    function updatePrevNext() {
      prevBtn.disabled = !playingList || playIndex <= 0;
      nextBtn.disabled = !playingList || playIndex >= (playingList?.length - 1);
    }
    function nextItem() { if (!playingList) return; if (playIndex < playingList.length - 1) { playIndex++; openModal(playingList[playIndex], beautifyTitle(playingList[playIndex])); updatePrevNext(); } }
    function prevItem() { if (!playingList) return; if (playIndex > 0) { playIndex--; openModal(playingList[playIndex], beautifyTitle(playingList[playIndex])); updatePrevNext(); } }
    nextBtn.addEventListener('click', nextItem);
    prevBtn.addEventListener('click', prevItem);
    playPlaylistBtn.addEventListener('click', () => { playList([...selectedOrder], 0); });

    // Initialize selections, fixed state, and playlists
    attachSelectionHandlers();
    document.querySelectorAll('.shot').forEach(shot => applyFixedUI(shot, isFixed(shot.dataset.path)));
    loadPlaylists();
    updateBar();

    // Query param open=path to auto-open
    const params = new URLSearchParams(location.search);
    const toOpen = params.get('open');
    if (toOpen) {
      try {
        const decoded = decodeURIComponent(toOpen);
        const doc = documents.find(d => d.path === decoded);
        if (doc) openModal(doc.path, doc.title);
      } catch (e) { /* ignore */ }
    }

    function updateQueryString(key, value) {
      const url = new URL(location.href);
      if (value === null) url.searchParams.delete(key); else url.searchParams.set(key, value);
      return url.toString();
    }
  </script>
</body>
</html>
